{# templates/admin/my_dashboard.html.twig #}
{% extends '@EasyAdmin/page/content.html.twig' %}

{% block main %}
    <div class="box">
        <!-- domains table -->
        <div class="sm-tbl-container" id="table1">
            <h2 class="text-center">Table</h2>
            <div class="tbl-header-small">
                <table class="custom-table-small">
                    <thead>
                        <tr>
                            <th class="th">Actifs</th>
                            <th class="th">Expire < 30 jours</th>
                            <th class="th">Suppressions programmées</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="tbl-content-small">
                <table class="custom-table-small">
                    <tr>
                        <td class="td">{{ activeDomains|length }}</td>
                        <td class="td">{{ domainsToExpire|length }}</td>
                        <td class="td">{{ domainsToSuppress|length }}</td>
                    </tr>
                </table>
            </div>
        </div>
        <!-- END domains table -->

        <!-- domains to expire list -->
        <div id="table2">
            <h2 class="text-center">domainsToExpire</h2>
            <div class="tbl-header">
                <table class="custom-table">
                    <tr>
                        <th class="th">domaine</th>
                        <th class="th">expire le</th>
                    </tr>
                </table>
            </div>
            <div class="tbl-content">
                <table class="custom-table">
                    {% for domain in domainsToExpire %}
                        <tr>
                            <td  class="td"><a href="{{ path('admin_domain_edit', {'entityId': domain.id}) }}">{{ domain.name }}</a></td>
                            <td  class="td">{{ domain.expireAt|date("d / m / y", "Europe/Paris") }}</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        <!-- END domains to expire list -->

        <!-- chart -->
        <div id="shitty-chart">
            <p>### Il y a un chart en dessous ###</p>
            {{ render_chart(chart) }}
            <p>### Il y a un chart au dessus ###</p>
        </div>
        <!-- END chart -->
        <div id="chart">
            <h2 class="text-center">Chart</h2>
            <canvas id="myChart"></canvas>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <script>
            const ctx = document.getElementById('myChart');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Actifs', 'Expire bientôt', 'Supression programmée'],
                    datasets: [{
                        label: 'Nombre de Domaines',
                        data: [{{ activeDomains|length }}, {{ domainsToExpire|length }}, {{ domainsToSuppress|length }}],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        </script>
    </div>
{% endblock main %}
